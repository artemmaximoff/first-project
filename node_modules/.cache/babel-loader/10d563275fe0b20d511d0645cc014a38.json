{"ast":null,"code":"import _asyncToGenerator from\"D:/react_projects/01-first-project/my-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";import _objectSpread from\"D:/react_projects/01-first-project/my-app/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";import _regeneratorRuntime from\"D:\\\\react_projects\\\\01-first-project\\\\my-app\\\\node_modules\\\\@babel\\\\runtime\\\\regenerator\\\\index.js\";import{authAPI,securityAPI}from'../api/api';var SET_USERS_DATA='SET_USERS_DATA';var GET_CAPTCHA_URL_SUCCESS='GET_CAPTCHA_URL_SUCCESS';var initialState={id:null,email:null,login:null,profile:null,isAuth:false,captchaUrl:null};var authReducer=function authReducer(){var state=arguments.length>0&&arguments[0]!==undefined?arguments[0]:initialState;var action=arguments.length>1?arguments[1]:undefined;switch(action.type){case SET_USERS_DATA:case GET_CAPTCHA_URL_SUCCESS:return _objectSpread(_objectSpread({},state),action.payload);default:return state;}};export var setAuthUserData=function setAuthUserData(id,email,login,isAuth,captchaUrl){return{type:SET_USERS_DATA,payload:{id:id,email:email,login:login,isAuth:isAuth,captchaUrl:captchaUrl}};};export var getCaptchaUrlSuccess=function getCaptchaUrlSuccess(captchaUrl){return{type:GET_CAPTCHA_URL_SUCCESS,payload:{captchaUrl:captchaUrl}};};export default authReducer;export var authMe=function authMe(){return/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(dispatch){var response,_response$data$data,id,email,_login;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.next=2;return authAPI.authMe();case 2:response=_context.sent;if(response.data.resultCode===0){_response$data$data=response.data.data,id=_response$data$data.id,email=_response$data$data.email,_login=_response$data$data.login;dispatch(setAuthUserData(id,email,_login,true));}case 4:case\"end\":return _context.stop();}}},_callee);}));return function(_x){return _ref.apply(this,arguments);};}();};export var login=function login(email,password,rememberMe,captcha,setStatus){return/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(dispatch){var response;return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:_context2.next=2;return authAPI.login(email,password,rememberMe,captcha);case 2:response=_context2.sent;if(response.data.resultCode===0){dispatch(authMe());}else{if(response.data.resultCode===10){dispatch(getCaptchaUrl());}setStatus(response.data.messages[0]);}case 4:case\"end\":return _context2.stop();}}},_callee2);}));return function(_x2){return _ref2.apply(this,arguments);};}();};export var getCaptchaUrl=function getCaptchaUrl(){return/*#__PURE__*/function(){var _ref3=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee3(dispatch){var response,captchaUrl;return _regeneratorRuntime.wrap(function _callee3$(_context3){while(1){switch(_context3.prev=_context3.next){case 0:_context3.next=2;return securityAPI.getCaptchaUrl();case 2:response=_context3.sent;captchaUrl=response.data.url;dispatch(getCaptchaUrlSuccess(captchaUrl));case 5:case\"end\":return _context3.stop();}}},_callee3);}));return function(_x3){return _ref3.apply(this,arguments);};}();};export var logout=function logout(){return/*#__PURE__*/function(){var _ref4=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee4(dispatch){var response;return _regeneratorRuntime.wrap(function _callee4$(_context4){while(1){switch(_context4.prev=_context4.next){case 0:_context4.next=2;return authAPI.logout();case 2:response=_context4.sent;if(response.data.resultCode===0){dispatch(setAuthUserData(null,null,null,false,null));}case 4:case\"end\":return _context4.stop();}}},_callee4);}));return function(_x4){return _ref4.apply(this,arguments);};}();};","map":{"version":3,"sources":["D:/react_projects/01-first-project/my-app/src/redux/auth-reducer.js"],"names":["authAPI","securityAPI","SET_USERS_DATA","GET_CAPTCHA_URL_SUCCESS","initialState","id","email","login","profile","isAuth","captchaUrl","authReducer","state","action","type","payload","setAuthUserData","getCaptchaUrlSuccess","authMe","dispatch","response","data","resultCode","password","rememberMe","captcha","setStatus","getCaptchaUrl","messages","url","logout"],"mappings":"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","sourcesContent":["import { authAPI, securityAPI } from '../api/api';\r\n\r\n\r\nconst SET_USERS_DATA = 'SET_USERS_DATA'\r\n\r\nconst GET_CAPTCHA_URL_SUCCESS = 'GET_CAPTCHA_URL_SUCCESS'\r\n\r\n\r\nlet initialState = {\r\n    id: null,\r\n    email: null,\r\n    login: null,\r\n    profile: null,\r\n    isAuth: false,\r\n    captchaUrl: null\r\n\r\n};\r\n\r\nconst authReducer = (state = initialState, action) => {\r\n\r\n    switch (action.type) {\r\n        case SET_USERS_DATA:\r\n        case GET_CAPTCHA_URL_SUCCESS:\r\n            return {\r\n                ...state,\r\n                ...action.payload\r\n            }\r\n        default:\r\n            return state;\r\n\r\n    }\r\n\r\n}\r\n\r\nexport const setAuthUserData = (id, email, login, isAuth, captchaUrl) => ({ type: SET_USERS_DATA, payload: { id, email, login, isAuth, captchaUrl } });\r\nexport const getCaptchaUrlSuccess = (captchaUrl) => ({ type: GET_CAPTCHA_URL_SUCCESS, payload: { captchaUrl } });\r\nexport default authReducer;\r\n\r\nexport const authMe = () => async (dispatch) => {\r\n    let response = await authAPI.authMe();\r\n    if (response.data.resultCode === 0) {\r\n        let { id, email, login } = response.data.data;\r\n        dispatch(setAuthUserData(id, email, login, true))\r\n    }\r\n}\r\n\r\n\r\n\r\nexport const login = (email, password, rememberMe, captcha, setStatus) => async (dispatch) => {\r\n    let response = await authAPI.login(email, password, rememberMe, captcha);\r\n    if (response.data.resultCode === 0) {\r\n        dispatch(authMe())\r\n    }\r\n\r\n    else {\r\n        if (response.data.resultCode === 10) {\r\n            dispatch(getCaptchaUrl())\r\n        }\r\n        setStatus(response.data.messages[0]);\r\n    }\r\n\r\n}\r\n\r\nexport const getCaptchaUrl = () => async (dispatch) => {\r\n    const response = await securityAPI.getCaptchaUrl();\r\n    const captchaUrl = response.data.url;\r\n    dispatch(getCaptchaUrlSuccess(captchaUrl))\r\n\r\n}\r\n\r\n\r\n\r\nexport const logout = () => async (dispatch) => {\r\n    let response = await authAPI.logout()\r\n    if (response.data.resultCode === 0) {\r\n        dispatch(setAuthUserData(null, null, null, false, null))\r\n    }\r\n}\r\n\r\n\r\n\r\n\r\n"]},"metadata":{},"sourceType":"module"}